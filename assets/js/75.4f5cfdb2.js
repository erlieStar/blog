(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{471:function(t,s,a){"use strict";a.r(s);var r=a(56),n=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"elasticsearch-性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-性能优化"}},[t._v("#")]),t._v(" ElasticSearch 性能优化")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200222092345247.jpg?",alt:"在这里插入图片描述"}})]),t._v(" "),a("h2",{attrs:{id:"提升写入性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提升写入性能"}},[t._v("#")]),t._v(" 提升写入性能")]),t._v(" "),a("h3",{attrs:{id:"使用-bulk-接口批量写入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-bulk-接口批量写入"}},[t._v("#")]),t._v(" 使用 bulk 接口批量写入")]),t._v(" "),a("ol",[a("li",[t._v("节省重复创建连接的网络开销")]),t._v(" "),a("li",[t._v("通过进行基准测试来找到最佳的批处理数量")])]),t._v(" "),a("h3",{attrs:{id:"延长-refresh-的时间间隔"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#延长-refresh-的时间间隔"}},[t._v("#")]),t._v(" 延长 refresh 的时间间隔")]),t._v(" "),a("ol",[a("li",[t._v("通过延长 refresh（刷新）的时间间隔可以降低段合并的频率，段合并十分耗费资源")]),t._v(" "),a("li",[t._v("默认的刷新频率为1s，对 index 修改 index.refresh_interval 即可立即生效")])]),t._v(" "),a("h3",{attrs:{id:"初始化性能的大量写入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化性能的大量写入"}},[t._v("#")]),t._v(" 初始化性能的大量写入")]),t._v(" "),a("ol",[a("li",[t._v("比如 reindex 或是导入基础数据这种一次性批量索引操作")]),t._v(" "),a("li",[t._v("可以配置成不刷新，并且把副本数也配置成0，完了之后再设置成正常值")])]),t._v(" "),a("h3",{attrs:{id:"关闭操作系统的-swapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭操作系统的-swapping"}},[t._v("#")]),t._v(" 关闭操作系统的 swapping")]),t._v(" "),a("ol",[a("li",[t._v("操作系统会自动把不常用的内存交换到磁盘（虚拟内存），关闭后就不会进行交换")])]),t._v(" "),a("h3",{attrs:{id:"使用自动生成的id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用自动生成的id"}},[t._v("#")]),t._v(" 使用自动生成的id")]),t._v(" "),a("ol",[a("li",[t._v("指明文档 id 时，es 需要先判断一下这个 id 对应的文档是否已经存在，以做一些合并或者更新操作。如果使用自生成的 id，可以跳过这个步骤，加快索引速度")])]),t._v(" "),a("h3",{attrs:{id:"合理设置字段-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#合理设置字段-mapping"}},[t._v("#")]),t._v(" 合理设置字段 mapping")]),t._v(" "),a("ol",[a("li",[t._v("不需要分析的字段就不用分析")])]),t._v(" "),a("h3",{attrs:{id:"合理设置分片和副本数量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#合理设置分片和副本数量"}},[t._v("#")]),t._v(" 合理设置分片和副本数量")]),t._v(" "),a("ol",[a("li",[t._v("副本数量越多，写入越慢")])]),t._v(" "),a("h2",{attrs:{id:"提升查询性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提升查询性能"}},[t._v("#")]),t._v(" 提升查询性能")]),t._v(" "),a("h3",{attrs:{id:"用过滤器上下文替代查询上下文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用过滤器上下文替代查询上下文"}},[t._v("#")]),t._v(" 用过滤器上下文替代查询上下文")]),t._v(" "),a("ol",[a("li",[t._v("过滤器上下文，不计算得分可以减少资源消耗，过滤器结果可以缓存")])]),t._v(" "),a("h3",{attrs:{id:"避免使用脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#避免使用脚本"}},[t._v("#")]),t._v(" 避免使用脚本")]),t._v(" "),a("ol",[a("li",[t._v("脚本非常耗性能，因为每次计算且无法缓存")]),t._v(" "),a("li",[t._v("如果非用不可，就用 painless 或者 expressions")])]),t._v(" "),a("h3",{attrs:{id:"提前索引字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提前索引字段"}},[t._v("#")]),t._v(" 提前索引字段")]),t._v(" "),a("p",[t._v("假如有如下的文档")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("PUT index/_doc/"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"designation"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"spoon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("经常进行如下的范围查询")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("GET index/_search\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"aggs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price_ranges"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"range"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"field"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ranges"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"to"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"from"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"to"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"from"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("索引的时候可以增加一个 price_range 字段，用来存储范围")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("PUT index\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"mappings"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"properties"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price_range"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nPUT index/_doc/"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"designation"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"spoon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price_range"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10-100"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("最开始的分组方式就可以改成如下形式")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("GET index/_search\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"aggs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price_ranges"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"terms"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"field"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price_range"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"合理-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#合理-mapping"}},[t._v("#")]),t._v(" 合理 mapping")]),t._v(" "),a("ol",[a("li",[t._v("数值数据可以映射为 numeric 类型或者keyword类型")]),t._v(" "),a("li",[t._v("数字类型适合范围查询")]),t._v(" "),a("li",[t._v("keyword 类型适合精确查询（精确查询时搜索 keywrod 比搜索 numeric 更快）")])]),t._v(" "),a("p",[t._v("比如产品id或者 ISBN（一种用于唯一标识图书的国际标准）基本上是用在精确查询的场景中，我们就可以映射为 keyword 类型")]),t._v(" "),a("h3",{attrs:{id:"使用更轻量的查询语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用更轻量的查询语句"}},[t._v("#")]),t._v(" 使用更轻量的查询语句")]),t._v(" "),a("ol",[a("li",[t._v("通配符查询很费性能，尤其是通配符放在前面")])]),t._v(" "),a("h3",{attrs:{id:"不要使用关联关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不要使用关联关系"}},[t._v("#")]),t._v(" 不要使用关联关系")]),t._v(" "),a("ol",[a("li",[t._v("不管是嵌套还是父子，都会使查询量倍增")])]),t._v(" "),a("h3",{attrs:{id:"增加副本数量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增加副本数量"}},[t._v("#")]),t._v(" 增加副本数量")]),t._v(" "),a("ol",[a("li",[t._v("查询时会查询主分片或副本分片，因此增加副本数量可以提高系统吞吐量")])]),t._v(" "),a("h3",{attrs:{id:"按时间查询时对时间进行四舍五入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#按时间查询时对时间进行四舍五入"}},[t._v("#")]),t._v(" 按时间查询时对时间进行四舍五入")]),t._v(" "),a("ol",[a("li",[t._v("这样可以更好的利用缓存")])]),t._v(" "),a("p",[t._v("在可以接受的前提下，可以从方式一改为方式二")]),t._v(" "),a("p",[t._v("方式一：查询当前时间减去1小时到当前时间，精确到秒的时间范围")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("GET index/_search\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"query"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"constant_score"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"range"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"my_date"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"gte"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"now-1h"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lte"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"now"')]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("方式二：和方式一相比，多了/m，表示这是一个精确到分钟的相对时间范围")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("GET index/_search\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"query"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"constant_score"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"range"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"my_date"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"gte"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"now-1h/m"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lte"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"now/m"')]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"如果-index-不再写入可以合并分段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如果-index-不再写入可以合并分段"}},[t._v("#")]),t._v(" 如果 index 不再写入可以合并分段")]),t._v(" "),a("ol",[a("li",[t._v("分段越少，查询越快，每次查询都要拆到所有分段去处理，再合并结果，有 _forcemerge 接口，可以把分段数设为1")]),t._v(" "),a("li",[t._v("甚至可以合并分片，reindex 或 shink")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("POST /my-index"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-000001")]),t._v("/_forcemerge\n")])])]),a("h3",{attrs:{id:"给文件系统-filesystem-cache-预留足够内存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#给文件系统-filesystem-cache-预留足够内存"}},[t._v("#")]),t._v(" 给文件系统（filesystem cache）预留足够内存")]),t._v(" "),a("ol",[a("li",[t._v("es 非常依赖操作系统的文件缓存来提高查询速度")]),t._v(" "),a("li",[t._v("预留至少一半的内存给文件系统缓存")])]),t._v(" "),a("h3",{attrs:{id:"使用-ssd-磁盘而且别用远程磁盘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-ssd-磁盘而且别用远程磁盘"}},[t._v("#")]),t._v(" 使用 ssd 磁盘而且别用远程磁盘")]),t._v(" "),a("ol",[a("li",[t._v("es需要频繁读取磁盘")])]),t._v(" "),a("h3",{attrs:{id:"路由优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由优化"}},[t._v("#")]),t._v(" 路由优化")]),t._v(" "),a("h2",{attrs:{id:"节省磁盘空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节省磁盘空间"}},[t._v("#")]),t._v(" 节省磁盘空间")]),t._v(" "),a("h3",{attrs:{id:"关闭不需要的特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭不需要的特性"}},[t._v("#")]),t._v(" 关闭不需要的特性")]),t._v(" "),a("ol",[a("li",[t._v("不被用来查询的字段，不索引")]),t._v(" "),a("li",[t._v("不做全文检索，不分词")]),t._v(" "),a("li",[t._v("不关注文档相关性，关闭 norms")]),t._v(" "),a("li",[t._v("不需要短语搜索，关闭位置索引")])]),t._v(" "),a("h3",{attrs:{id:"不要使用自动-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不要使用自动-mapping"}},[t._v("#")]),t._v(" 不要使用自动 mapping")]),t._v(" "),a("ol",[a("li",[t._v("默认会对 string 字段做两次索引（text 和 keyword）")])]),t._v(" "),a("h3",{attrs:{id:"禁用-source-字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#禁用-source-字段"}},[t._v("#")]),t._v(" 禁用 _source 字段")]),t._v(" "),a("ol",[a("li",[t._v("_source字段存储了文档原始的 json 格式，如果不需要访问，可以禁用")])]),t._v(" "),a("h3",{attrs:{id:"配置压缩存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置压缩存储"}},[t._v("#")]),t._v(" 配置压缩存储")]),t._v(" "),a("h3",{attrs:{id:"分段合并"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分段合并"}},[t._v("#")]),t._v(" 分段合并")]),t._v(" "),a("ol",[a("li",[t._v("段里面的数据是逻辑删除的，段合并的时候会将这些数据真正删除")])]),t._v(" "),a("h3",{attrs:{id:"数字类型用最小数字类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数字类型用最小数字类型"}},[t._v("#")]),t._v(" 数字类型用最小数字类型")]),t._v(" "),a("ol",[a("li",[t._v("尽量选择占用空间较小的数组类型，byte < short < integer < long")])])])}),[],!1,null,null,null);s.default=n.exports}}]);