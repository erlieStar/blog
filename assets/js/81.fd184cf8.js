(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{480:function(s,t,a){"use strict";a.r(t);var n=a(56),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"elasticsearch-集群搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-集群搭建"}},[s._v("#")]),s._v(" ElasticSearch 集群搭建")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/995ba2069cba4fbba92d9a250b1471df.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h2",{attrs:{id:"安装基础环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装基础环境"}},[s._v("#")]),s._v(" 安装基础环境")]),s._v(" "),a("p",[s._v("我们用虚拟机创建出3台机器，修改主机名为s1，s2和s3")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开如下文件，修改主机名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/hostname\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启机器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n")])])]),a("p",[s._v("查看centos版本为7.9")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@s1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/centos-release")]),s._v("\nCentOS Linux release "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.9")]),s._v(".2009 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AltArch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("下载相关命令")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" vim*\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" net-tools\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v("\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\n")])])]),a("p",[s._v("执行ifconfig命令获取ip地址")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("hostname")]),s._v(" "),a("th",[s._v("ip")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("s1")]),s._v(" "),a("td",[s._v("192.168.9.128")])]),s._v(" "),a("tr",[a("td",[s._v("s2")]),s._v(" "),a("td",[s._v("192.168.9.129")])]),s._v(" "),a("tr",[a("td",[s._v("s3")]),s._v(" "),a("td",[s._v("192.168.9.130")])])])]),s._v(" "),a("p",[s._v("在3台服务器上配置host，添加如下内容\nvim /etc/hosts")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".9.128 s1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".9.129 s2\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".9.130 s3\n")])])]),a("p",[s._v("我们配置一下server-1到server-2和server-3的ssh登陆")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在3台机器执行如下命令")]),s._v("\nssh-keygen -t rsa\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看server-1的公钥")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/id_rsa.pub\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将server-1的公钥放到server-1，server-2和server-3的如下文件中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ~/.ssh/authorized_keys\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在server-1执行如下命令能正常调转则说明成功")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@s1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@s2\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@s3\n")])])]),a("p",[s._v("启动 es 不能使用 root 用户，所以创建一个其他用户")]),s._v(" "),a("p",[s._v("https://www.elastic.co/cn/downloads/past-releases/elasticsearch-8-1-0\n注意要选对版本，不然 java 命令执行会报错")]),s._v(" "),a("p",[s._v("以下命令同时在 3 台服务器执行")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/soft\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/soft\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.1.0-linux-aarch64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf elasticsearch-8.1.0-linux-aarch64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建数据文件目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/soft/elasticsearch-8.1.0/data\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建证书目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/soft/elasticsearch-8.1.0/config/certs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增 es 用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" es\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改文件拥有者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R es:es /opt/soft/elasticsearch-8.1.0\n")])])]),a("h2",{attrs:{id:"生成安全证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成安全证书"}},[s._v("#")]),s._v(" 生成安全证书")]),s._v(" "),a("p",[s._v("在第一台服务器节点生成安全证书")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" es\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/soft/elasticsearch-8.1.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 签发 ca 证书，过程中需按两次回车键")]),s._v("\nbin/elasticsearch-certutil ca\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用 ca 证书签发节点证书，过程中需按三次回车键")]),s._v("\nbin/elasticsearch-certutil cert --ca elastic-stack-ca.p12\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将生成的证书移动到 config/certs 目录中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" elastic-stack-ca.p12 elastic-certificates.p12 config/certs\n")])])]),a("h2",{attrs:{id:"生成-http-证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成-http-证书"}},[s._v("#")]),s._v(" 生成 http 证书")]),s._v(" "),a("p",[s._v("在第一台服务器节点生成集群多节点 http 证书")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("bin/elasticsearch-certutil http\n")])])]),a("p",[s._v("一些需要操作的部分如下所示")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Generate a CSR? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("n\nUse an existing CA? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("y\nCA Path: certs/elastic-stack-ca.p12\nPassword "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" elastic-stack-ca.p12:\nFor how long should your certificate be valid? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 5y\nGenerate a certificate per node? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("n\nWhen you are done, press "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ENTER"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" once "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" to move on to the next step.\ns1\ns2\ns3\nIs this correct "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Y/n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("y\nWhen you are done, press "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ENTER"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" once "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" to move on to the next step.\ns1的ip地址\ns2的ip地址\ns3的ip地址\nIs this correct "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Y/n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("y\nDo you wish to change any of these options? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("n\nProvide a password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http.p12"')]),s._v(" file:  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ENTER"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWhat filename should be used "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the output "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),s._v(" file? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/opt/soft/elasticsearch-8.1.0/elasticsearch-ssl-http.zip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" elasticsearch-ssl-http.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" elasticsearch/http.p12 kibana/elasticsearch-ca.pem config/certs\n")])])]),a("h2",{attrs:{id:"配置节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置节点"}},[s._v("#")]),s._v(" 配置节点")]),s._v(" "),a("p",[s._v("配置第一个节点")]),s._v(" "),a("p",[s._v("elasticsearch.yml")]),s._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" es"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path.data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /opt/soft/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8.1.0/data\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path.logs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /opt/soft/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8.1.0/logs\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" s1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery.seed_hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安全认证")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.enrollment.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.http.ssl.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.http.ssl.keystore.path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /opt/soft/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8.1.0/config/certs/http.p12\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.http.ssl.truststore.path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /opt/soft/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8.1.0/config/certs/http.p12\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.verification_mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" certificate\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.keystore.path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /opt/soft/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8.1.0/config/certs/elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("certificates.p12\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.truststore.path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /opt/soft/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8.1.0/config/certs/elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("certificates.p12\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node-1 为上面配置的节点名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.initial_master_nodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("_local_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" _site_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ingest.geoip.downloader.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.http.ssl.client_authentication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" none\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前台启动")]),s._v("\nbin/elasticsearch\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台启动")]),s._v("\nbin/elasticsearch -d\n")])])]),a("p",[s._v("启动报错")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ERROR: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bootstrap checks failed. You must address the points described "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the following "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" lines before starting Elasticsearch.\nbootstrap check failure "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": max "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" descriptors "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" elasticsearch process is too low, increase to at least "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nbootstrap check failure "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": max number of threads "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2723")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("es"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" is too low, increase to at least "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nbootstrap check failure "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": max virtual memory areas vm.max_map_count "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65530")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" is too low, increase to at least "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[s._v("前面2个报错")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在root用户下追加配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/security/limits.conf \n* soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n* hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n* soft nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n* hard nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])])]),a("p",[s._v("第3个报错")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在root用户下追加配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/sysctl.conf\nvm.max_map_count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n")])])]),a("p",[s._v("重新加载 /etc/sysctl.conf 配置")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sysctl -p\n")])])]),a("p",[s._v("9300端口为es集群组件的通信端口，9200端口为浏览器访问的 http 协议的restful端口，防火墙打开9200和9300端口")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/sbin/iptables -I INPUT -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(" -j ACCEPT\n/sbin/iptables -I INPUT -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(" -j ACCEPT\n")])])]),a("p",[s._v("访问 https://s1:9200，能正常访问即可，用户名和密码在启动日志中")]),s._v(" "),a("p",[s._v("将加密文件和配置文件分发到其他机器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /opt/soft/elasticsearch-8.1.0/config/certs s2:/opt/soft/elasticsearch-8.1.0/config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /opt/soft/elasticsearch-8.1.0/config/certs s3:/opt/soft/elasticsearch-8.1.0/config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /opt/soft/elasticsearch-8.1.0/config/elasticsearch.yml s2:/opt/soft/elasticsearch-8.1.0/config/elasticsearch.yml\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /opt/soft/elasticsearch-8.1.0/config/elasticsearch.yml s3:/opt/soft/elasticsearch-8.1.0/config/elasticsearch.yml\n")])])]),a("p",[s._v("配置其他节点，将 node.name 和 network.host 改成对应的值即可")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("node.name: node-2\nnetwork.host: s2\n")])])]),a("h2",{attrs:{id:"kibana-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kibana-安装"}},[s._v("#")]),s._v(" Kibana 安装")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://artifacts.elastic.co/downloads/kibana/kibana-8.1.0-linux-aarch64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf kibana-8.1.0-linux-aarch64.tar.gz\n")])])]),a("p",[s._v("给 Kibana 生成证书文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/soft/elasticsearch-8.1.0\nbin/elasticsearch-certutil csr -name kibana -dns s1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" csr-bundle.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" kibana/kibana.csr kibana/kibana.key /opt/soft/kibana-8.1.0/config\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/soft/kibana-8.1.0/config\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 openssl")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y openssl openssl-devel\nopenssl x509 -req -in kibana.csr -signkey kibana.key -out kibana.crt\n")])])]),a("p",[s._v("生成账号密码")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("bin/elasticsearch-reset-password -u kibana\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 密码如下")]),s._v("\nNew value: *iBewlzbzMK3X0eH3Ffy\n")])])]),a("p",[s._v("kibnana.yml")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("server.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v("\nserver.host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s1"')]),s._v("\ni18n.locale: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zh-CN"')]),s._v("\n\nelasticsearch.hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://s1:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nelasticsearch.username: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kibana"')]),s._v("\nelasticsearch.password: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*iBewlzbzMK3X0eH3Ffy"')]),s._v("\n\nelasticsearch.ssl.verificationMode: none\n\nelasticsearch.ssl.certificateAuthorities: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/soft/elasticsearch-8.1.0/config/certs/elasticsearch-ca.pem"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nserver.ssl.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nserver.ssl.certificate: /opt/soft/kibana-8.1.0/config/kibana.crt\nserver.ssl.key: /opt/soft/kibana-8.1.0/config/kibana.key\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R es:es /opt/soft/kibana-8.1.0\n")])])]),a("p",[s._v("启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" es\nbin/kibana\n")])])]),a("p",[s._v("访问 https://s1:5601")]),s._v(" "),a("h2",{attrs:{id:"安装-ik-分词器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-ik-分词器"}},[s._v("#")]),s._v(" 安装 IK 分词器")]),s._v(" "),a("p",[s._v("https://github.com/medcl/elasticsearch-analysis-ik")]),s._v(" "),a("p",[s._v("下载并解压到 plugins/ik 文件夹")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/soft/elasticsearch-8.1.0/plugins "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" ik\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ik\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.1.0/elasticsearch-analysis-ik-8.1.0.zip\n")])])]),a("p",[s._v("分发到其他节点")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /opt/soft/elasticsearch-8.1.0/plugins/ik/elasticsearch-analysis-ik-8.1.0.zip s2:/opt/soft/elasticsearch-8.1.0/plugins/ik\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /opt/soft/elasticsearch-8.1.0/plugins/ik/elasticsearch-analysis-ik-8.1.0.zip s3:/opt/soft/elasticsearch-8.1.0/plugins/ik\n")])])]),a("p",[s._v("重启集群，能正常分词即可")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("POST _analyze\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"analyzer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_smart"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"测试分词效果"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);