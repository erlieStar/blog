(window.webpackJsonp=window.webpackJsonp||[]).push([[231],{629:function(t,s,a){"use strict";a.r(s);var e=a(56),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"rocketmq源码解析-rocketmq是如何存储消息的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq源码解析-rocketmq是如何存储消息的"}},[t._v("#")]),t._v(" RocketMQ源码解析：RocketMQ是如何存储消息的？")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210417191903114.jpg?",alt:"在这里插入图片描述"}})]),t._v(" "),a("h2",{attrs:{id:"broker端使用到的文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#broker端使用到的文件"}},[t._v("#")]),t._v(" Broker端使用到的文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210417191931607.png?",alt:"在这里插入图片描述"}}),t._v("\n我们先来看一下RocketMQ的消息存储流程，当消息发送到RocketMQ上时，会被顺序写入CommitLog文件，这样能保证消息存储的高性能和高吞吐量。")]),t._v(" "),a("p",[t._v("但是消息是按照Topic来消费的，如果消费时从CommitLog上查找对应的消息时，会比较慢。为了提高消息消费的效率，RocketMQ会将Topic一样的消息放在ConsumerQueue中，每个ConsumerQueue又分为几个写队列，一个队列一个文件。")]),t._v(" "),a("p",[t._v("假如创建一个名为TopicTest的topic，并创建4个写队列。那么在RocketMQ是通过如下形式存储的\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/96d158e032184d85870f5c2651406fab.png",alt:"在这里插入图片描述"}}),t._v("\n需要注意的是，CommitLog和ComsumerQueue并不是将相同的消息存储了2份。CommitLog存储了消息原始的内容，而ComsumerQueue主要存储了消息在CommitLog中的偏移量，具体的消息格式看下图\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/a5ed8222e1864089a8ac4df7a6dc2401.png?",alt:"请添加图片描述"}}),t._v(" "),a("strong",[t._v("borker端存储的消息格式如下")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("内容")]),t._v(" "),a("th",[t._v("解释")]),t._v(" "),a("th",[t._v("长度")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("TOTALSIZE")]),t._v(" "),a("td",[t._v("消息总长度")]),t._v(" "),a("td",[t._v("4字节")])]),t._v(" "),a("tr",[a("td",[t._v("MAGICCODE")]),t._v(" "),a("td",[t._v("魔术，固定值Oxdaa320a7")]),t._v(" "),a("td",[t._v("4字节")])]),t._v(" "),a("tr",[a("td",[t._v("BODYCRC")]),t._v(" "),a("td",[t._v("消息crc校验码")]),t._v(" "),a("td",[t._v("4字节")])]),t._v(" "),a("tr",[a("td",[t._v("QUEUEID")]),t._v(" "),a("td",[t._v("消息队列id")]),t._v(" "),a("td",[t._v("4字节")])]),t._v(" "),a("tr",[a("td",[t._v("FLAG")]),t._v(" "),a("td",[t._v("消息flag，供应用程序使用")]),t._v(" "),a("td",[t._v("4字节")])]),t._v(" "),a("tr",[a("td",[t._v("QUEUEOFFSET")]),t._v(" "),a("td",[t._v("消息在消费队列的偏移量")]),t._v(" "),a("td",[t._v("8字节")])]),t._v(" "),a("tr",[a("td",[t._v("PHYSICALOFFSET")]),t._v(" "),a("td",[t._v("消息在CommitLog文件中的偏移量")]),t._v(" "),a("td",[t._v("8字节")])]),t._v(" "),a("tr",[a("td",[t._v("SYSFLAG")]),t._v(" "),a("td",[t._v("消息系统flag，例如是否压缩，是否是事务消息等")]),t._v(" "),a("td",[t._v("4字节")])]),t._v(" "),a("tr",[a("td",[t._v("BORNTIMESTAMP")]),t._v(" "),a("td",[t._v("生产者调用消息发送API的时间戳")]),t._v(" "),a("td",[t._v("8字节")])]),t._v(" "),a("tr",[a("td",[t._v("BORNHOST")]),t._v(" "),a("td",[t._v("消息发送者ip，端口号")]),t._v(" "),a("td",[t._v("8字节")])]),t._v(" "),a("tr",[a("td",[t._v("STORETIMESTAMP")]),t._v(" "),a("td",[t._v("消息存储时间戳")]),t._v(" "),a("td",[t._v("8字节")])]),t._v(" "),a("tr",[a("td",[t._v("STOREHOSTADDRESS")]),t._v(" "),a("td",[t._v("Broker服务器ip+端口号")]),t._v(" "),a("td",[t._v("8字节")])]),t._v(" "),a("tr",[a("td",[t._v("RECONSUMETIMES")]),t._v(" "),a("td",[t._v("消息重试次数")]),t._v(" "),a("td",[t._v("4字节")])]),t._v(" "),a("tr",[a("td",[t._v("Prepared Transaction Offset")]),t._v(" "),a("td",[t._v("事务消息物理偏移量")]),t._v(" "),a("td",[t._v("8字节")])]),t._v(" "),a("tr",[a("td",[t._v("BodyLength")]),t._v(" "),a("td",[t._v("消息体长度")]),t._v(" "),a("td",[t._v("4字节")])]),t._v(" "),a("tr",[a("td",[t._v("Body")]),t._v(" "),a("td",[t._v("消息体内容")]),t._v(" "),a("td",[t._v("BodyLength字节")])]),t._v(" "),a("tr",[a("td",[t._v("TopicLength")]),t._v(" "),a("td",[t._v("topic长度，1字节，即主题名称不能超过255个字符")]),t._v(" "),a("td",[t._v("1字节")])]),t._v(" "),a("tr",[a("td",[t._v("Topic")]),t._v(" "),a("td",[t._v("主题")]),t._v(" "),a("td",[t._v("TopicLength字节")])]),t._v(" "),a("tr",[a("td",[t._v("PropertiesLength")]),t._v(" "),a("td",[t._v("消息属性长度")]),t._v(" "),a("td",[t._v("2字节")])]),t._v(" "),a("tr",[a("td",[t._v("Properties")]),t._v(" "),a("td",[t._v("消息属性")]),t._v(" "),a("td",[t._v("PropertiesLength字节")])])])]),t._v(" "),a("p",[t._v("ConsumerQueue中消息的格式如下")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/23c4b59e7a7a4de9876125426944af99.png",alt:"请添加图片描述"}})]),t._v(" "),a("p",[a("strong",[t._v("根据commitlog offset 和 size 就能从IndexFile中获取到具体的消息内容，而 tag hashcode 用来根据topic+tag消费时过滤消息")])]),t._v(" "),a("p",[t._v("从存储图看到还有一个IndexFile和CommitLog也有关系")]),t._v(" "),a("p",[a("strong",[t._v("IndexFile的主要作用就是用来根据Message Key和Unique Key查找对应的消息")])]),t._v(" "),a("p",[t._v("IndexFile文件结构如下所示")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210509165729959.png?",alt:"在这里插入图片描述"}}),t._v("\n从图中可以看出，IndexFile主要分为如下3部分，IndexHead，Hash槽，Index条目")]),t._v(" "),a("p",[a("strong",[t._v("IndexHead的格式如下")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("字段")]),t._v(" "),a("th",[t._v("解释")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("beginTimestamp")]),t._v(" "),a("td",[t._v("消息的最小存储时间")])]),t._v(" "),a("tr",[a("td",[t._v("endTimestamp")]),t._v(" "),a("td",[t._v("消息的最大存储时间")])]),t._v(" "),a("tr",[a("td",[t._v("beginPhyOffset")]),t._v(" "),a("td",[t._v("消息的最小偏移量（commitLog文件中的偏移量）")])]),t._v(" "),a("tr",[a("td",[t._v("endPhyOffset")]),t._v(" "),a("td",[t._v("消息的最大偏移量（commitLog文件中的偏移量）")])]),t._v(" "),a("tr",[a("td",[t._v("hashSlotCount")]),t._v(" "),a("td",[t._v("hash槽个数")])]),t._v(" "),a("tr",[a("td",[t._v("indexCount")]),t._v(" "),a("td",[t._v("index条目当前已使用的个数")])])])]),t._v(" "),a("p",[a("strong",[t._v("Hash槽存储的内容为落在该Hash槽内的Index的索引（看后面图示你就会很清楚了）")])]),t._v(" "),a("p",[t._v("每个Index条目的格式如下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("字段")]),t._v(" "),a("th",[t._v("解释")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("hashcode")]),t._v(" "),a("td",[t._v("key的hashcode")])]),t._v(" "),a("tr",[a("td",[t._v("phyoffset")]),t._v(" "),a("td",[t._v("消息的偏移量（commitLog文件中的偏移量）")])]),t._v(" "),a("tr",[a("td",[t._v("timedif")]),t._v(" "),a("td",[t._v("该消息存储时间与第一条消息的时间戳的差值，小于0该消息无效")])]),t._v(" "),a("tr",[a("td",[t._v("pre index no")]),t._v(" "),a("td",[t._v("该条目的前一条记录的Index索引，当hash冲突时，用来构建链表")])])])]),t._v(" "),a("p",[t._v("key的组成有如下两种形式")]),t._v(" "),a("ol",[a("li",[t._v("Topic#Unique Key")]),t._v(" "),a("li",[t._v("Topic#Message Key")])]),t._v(" "),a("p",[t._v("Unique Key是在producer端发送消息生成的")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DefaultMQProducerImpl#sendKernelImpl")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageBatch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageClientIDSetter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUniqID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Message Key是我们在发送消息的时候设置的哈，通常具有业务意义，方便我们快速查找消息")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定 topicName，tagName，MessageKey，消息内容，然后发送消息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" messageKey "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("randomUUID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TOPIC_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TAG_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" messageKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello rocketmq "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RemotingHelper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT_CHARSET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SendResult")]),t._v(" sendResult "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sendResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("IndexFile构成过程比较麻烦，画图演示一下把，你可以把IndexFile想成基于文件实现的HashMap")]),t._v("。")]),t._v(" "),a("p",[t._v("假如说往数组长度为10的HashMap依次放入3个key为11，34，21的数据（以尾插法演示了哈），HashMap的结构如下")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/2021042316522844.png?",alt:"在这里插入图片描述"}})]),t._v(" "),a("p",[a("strong",[t._v("将key为11，34，21的数据放到IndexFile中的过程如下（假如hash槽的数量为10")]),t._v("）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210509155655982.png?",alt:"在这里插入图片描述"}})]),t._v(" "),a("p",[t._v("具体的过程为")]),t._v(" "),a("ol",[a("li",[t._v("将消息顺序放到Index条目中，将11放到index=1的位置（用index[1]表示哈），11%1=1，算出hash槽的位置是1，存的值是0（刚开始都是0，用hash[0]表示），将index[1].preIndexNo=hash[0]=0，hash[0]=1（1为index数组下标哈）")]),t._v(" "),a("li",[t._v("将34放到index[2]，34%10=4，index[2].preIndexNo=hash[0]=0")]),t._v(" "),a("li",[t._v("将21放到index[3]，21%10=1，index[3].preIndexNo=hash[1]=1")])]),t._v(" "),a("p",[t._v("从图中可以看出来，当发生hash冲突时Index条目的preIndexNo属性充当了链表的作用。查找的过程和HashMap基本类似，先定位到槽的位置，然后顺着链表找就行了。")]),t._v(" "),a("p",[t._v("对具体算法感兴趣的可以看看源码，我就不贴代码了，有点多也不重要")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// IndexFile的构建过程")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("IndexFile")]),t._v("#putKey\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// IndexFile的查找过程")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("IndexFile")]),t._v("#selectPhyOffset\n")])])]),a("h2",{attrs:{id:"其他文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他文件"}},[t._v("#")]),t._v(" 其他文件")]),t._v(" "),a("p",[t._v("除了上述三种文件外，在rocketmq store文件夹下还有如下几种其他文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/c90c73401af9460da8435f282da86003.png",alt:"在这里插入图片描述"}})]),t._v(" "),a("p",[t._v("lock：有时候一台机器上会起多个broker，如果数据文件放在一个目录，这时候可以通过锁来提示你使用另一个目录，防止冲突")]),t._v(" "),a("p",[t._v("checkpoint：文件检查点，存储commitLog最后一次刷盘时间戳，consumeQueue最后一次刷盘时间戳，IndexFile最后一次刷盘时间戳")]),t._v(" "),a("p",[t._v("config：运行期间一些配置信息")]),t._v(" "),a("p",[t._v("abort：如果存在abort文件说明Broker非正常关闭，该文件默认启动时创建，正常退出时删除")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/ad15b732e7114c56996024153021d0c9.png",alt:"请添加图片描述"}})]),t._v(" "),a("h2",{attrs:{id:"源码解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码解析"}},[t._v("#")]),t._v(" 源码解析")]),t._v(" "),a("p",[t._v("消息写入commitLog的过程比较重要，后面会开单独的章节来分析，这次我们就分析一下从CommitLog读取数据构建ConsumeQueue和IndexFile的过程\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/4d9b2f5c056e4cd08983435912a32ab4.png?",alt:"在这里插入图片描述"}}),t._v("\nReputMessageService每隔1ms执行一次doReput，构建ConsumeQueue和IndexFile")]),t._v(" "),a("p",[t._v("DefaultMessageStore.ReputMessageService#run\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/83f2503c441041529e2a0facf09e7515.png?",alt:"在这里插入图片描述"}}),t._v("\n如下图所示，我挑了一部分比较重要的代码，标红的就是执行构建的过程。接着的一块代码和长轮询相关（长轮询相关的内容我们后面会详细介绍）")]),t._v(" "),a("p",[t._v("DefaultMessageStore.ReputMessageService#doReput\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/5ee55540ab154cf4b7470f513e7a4831.png?",alt:"在这里插入图片描述"}}),t._v("\n在dispatcherList中总共有2个类\nCommitLogDispatcherBuildConsumeQueue：用来构建ConsumeQueue\nCommitLogDispatcherBuildIndex：用来构建IndexFile")]),t._v(" "),a("p",[t._v("DefaultMessageStore#doDispatch\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/ecee46941153486c9140609b459d2a42.png",alt:"在这里插入图片描述"}})]),t._v(" "),a("h3",{attrs:{id:"构建consumequeue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建consumequeue"}},[t._v("#")]),t._v(" 构建ConsumeQueue")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/829c799520be4966b108dff8caf2d8fb.png?",alt:"在这里插入图片描述"}}),t._v("\n非事务消息，事务提交消息会被放入ConsumeQueue。而半消息和回滚消息则不会，因为他们不会被用户消费哈")]),t._v(" "),a("h3",{attrs:{id:"构建indexfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建indexfile"}},[t._v("#")]),t._v(" 构建IndexFile")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/73fe8b3019204ccd99c11d0183a7d1dc.png",alt:"在这里插入图片描述"}}),t._v("\n前面演示过了哈，构建IndexFile的过程和往hashmap放值类似。")]),t._v(" "),a("p",[t._v("可以看到key的形式有如下两种")]),t._v(" "),a("ol",[a("li",[t._v("Topic#Unique Key")]),t._v(" "),a("li",[t._v("Topic#Message Key")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/8bdc75122291463591bba63f1007d591.png?",alt:"在这里插入图片描述"}}),t._v("\n下面我们就详细分析commitLog的构建过程")])])}),[],!1,null,null,null);s.default=n.exports}}]);