(window.webpackJsonp=window.webpackJsonp||[]).push([[142],{541:function(t,s,a){"use strict";a.r(s);var n=a(56),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"面试官-生产环境发生问题-你一般怎么排查-jvm命令行监控工具篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#面试官-生产环境发生问题-你一般怎么排查-jvm命令行监控工具篇"}},[t._v("#")]),t._v(" 面试官：生产环境发生问题，你一般怎么排查？（JVM命令行监控工具篇）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210707140945668.jpg?",alt:"在这里插入图片描述"}})]),t._v(" "),a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),a("p",[t._v("在生产环境中，经常会遇到各种各样奇葩的性能问题，所以掌握最基本的JVM命令行监控工具还是很有必要的")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("名称")]),t._v(" "),a("th",[t._v("主要作用")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("jps")]),t._v(" "),a("td",[t._v("查看正在运行的Java进程")])]),t._v(" "),a("tr",[a("td",[t._v("jstack")]),t._v(" "),a("td",[t._v("打印线程快照")])]),t._v(" "),a("tr",[a("td",[t._v("jmap")]),t._v(" "),a("td",[t._v("导出堆内存映像文件")])]),t._v(" "),a("tr",[a("td",[t._v("jstat")]),t._v(" "),a("td",[t._v("查看jvm统计信息")])]),t._v(" "),a("tr",[a("td",[t._v("jinfo")]),t._v(" "),a("td",[t._v("实时查看和修改jvm配置参数")])]),t._v(" "),a("tr",[a("td",[t._v("jhat")]),t._v(" "),a("td",[t._v("用于分析heapdump文件")])])])]),t._v(" "),a("h2",{attrs:{id:"jps-查看正在运行的java进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jps-查看正在运行的java进程"}},[t._v("#")]),t._v(" jps:查看正在运行的Java进程")]),t._v(" "),a("p",[t._v("jps可以列出正在运行的Java进程，并显示虚拟机执行主类（Main Class，main()函数所在的类）名称以及进程id")]),t._v(" "),a("p",[a("strong",[t._v("如果想看一个命令的后面加 -help参数即可")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-0-14-centos ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# jps -help")]),t._v("\nusage: jps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-help"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n       jps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-q"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-mlvV"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("hostid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nDefinitions:\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("hostid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[a("strong",[t._v("可以看到可以监控远程服务，但是基于安全考虑，一般不使用")])]),t._v(" "),a("p",[t._v("常见的选项如下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("选项")]),t._v(" "),a("th",[t._v("作用")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("-q")]),t._v(" "),a("td",[t._v("只输出进程id")])]),t._v(" "),a("tr",[a("td",[t._v("-m")]),t._v(" "),a("td",[t._v("输出传递给主类main函数的参数")])]),t._v(" "),a("tr",[a("td",[t._v("-l")]),t._v(" "),a("td",[t._v("输出主类全类名，如果进程执行的是Jar包，输出jar包名字")])]),t._v(" "),a("tr",[a("td",[t._v("-v")]),t._v(" "),a("td",[t._v("程序启动时指定的jvm参数")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("cis@mt002:~$ jps\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("70208")]),t._v(" KmpService\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("183525")]),t._v(" LinkAnalysisServer\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25160")]),t._v(" MipSerachServer\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("cis@mt002:~$ jps -l\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("70208")]),t._v(" com.st.kmp.main.KmpService\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("183525")]),t._v(" com.st.cis.main.LinkAnalysisServer\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25160")]),t._v(" com.st.cis.main.MipSerachServer\n")])])]),a("h2",{attrs:{id:"jstack-打印线程快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstack-打印线程快照"}},[t._v("#")]),t._v(" jstack:打印线程快照")]),t._v(" "),a("p",[a("strong",[t._v("查看某个Java进程中所有线程的状态。一般用来定位线程出现长时间停顿的原因，如发生死循环，死锁，请求外部资源长时间等待等！")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeadLockDemo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" lockA "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" lockB "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" threadA "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lockA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SECONDS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get lockA"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lockB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"threadA run finish"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" threadB "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lockB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SECONDS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get lockB"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lockA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"threadB run finish"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        threadA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myThreadA"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        threadB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myThreadB"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        threadA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        threadB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("我写了一个死锁的例子，启动后执行jps找到进程id为19457")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("peng"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@pengdeMacBook")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Pro")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" jps\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19457")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeadLockDemo")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19458")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Launcher")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2658")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19459")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Jps")]),t._v("\n")])])]),a("p",[t._v("接着执行如下命令，列出了这个进程每个线程的执行状态")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("jstack "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19457")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210707144554346.png?",alt:"在这里插入图片描述"}})]),t._v(" "),a("p",[a("strong",[t._v("从图中可以看到有很多线程，GC线程，myThreadA，myThreadB等，其中myThreadA和myThreadB的线程状态为BLOCKED，并且在最后提示出了死锁发生的位置")])]),t._v(" "),a("h2",{attrs:{id:"jmap-导出堆内存映像文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmap-导出堆内存映像文件"}},[t._v("#")]),t._v(" jmap:导出堆内存映像文件")]),t._v(" "),a("p",[a("strong",[t._v("jmap主要用来用来导出堆内存映像文件，看是否发生内存泄露等。")])]),t._v(" "),a("p",[t._v("生产环境我们一般会配置如下参数，让虚拟机在OOM异常出现之后自动生成dump文件")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HeapDumpOnOutOfMemoryError")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HeapDumpPath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Users")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("peng\n")])])]),a("p",[t._v("执行如下命令即可手动获得dump文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("jmap -dump:file"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("文件名.dump 进程id\n")])])]),a("p",[a("strong",[t._v("分析堆内存的工具有很多，如Java VisualVM，jhat等。但个人觉得最好用的就是Eclipse Memory Analyzer，没有之一")])]),t._v(" "),a("h2",{attrs:{id:"jstat-查看jvm统计信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstat-查看jvm统计信息"}},[t._v("#")]),t._v(" jstat:查看jvm统计信息")]),t._v(" "),a("p",[a("strong",[t._v("jstat可以显示本地或者远程虚拟机进程中的类装载、 内存、 垃圾收集、 JIT编译等运行数据")])]),t._v(" "),a("p",[t._v("用jstat查看一下类装载的信息。我个人很少使用这个命令，命令行看垃圾收集信息真不如看图形界面方便，就不多做介绍了。")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@VM")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("centos "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("# jstat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19402")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Loaded")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bytes")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Unloaded")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bytes")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Time")]),t._v("   \n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10229")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19679.1")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("76.0")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.33")]),t._v("\n")])])]),a("p",[t._v("含义如下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Loaded")]),t._v(" "),a("th",[t._v("解释")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Loaded")]),t._v(" "),a("td",[t._v("加载类的个数")])]),t._v(" "),a("tr",[a("td",[t._v("Bytes")]),t._v(" "),a("td",[t._v("加载类的字节数")])]),t._v(" "),a("tr",[a("td",[t._v("Unloaded")]),t._v(" "),a("td",[t._v("卸载类的个数")])]),t._v(" "),a("tr",[a("td",[t._v("Bytes")]),t._v(" "),a("td",[t._v("卸载类的字节数")])]),t._v(" "),a("tr",[a("td",[t._v("Time")]),t._v(" "),a("td",[t._v("花费的时间")])])])]),t._v(" "),a("h2",{attrs:{id:"jinfo-实时查看和修改jvm配置参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jinfo-实时查看和修改jvm配置参数"}},[t._v("#")]),t._v(" jinfo:实时查看和修改jvm配置参数")]),t._v(" "),a("p",[t._v("jinfo的作用是实时地查看和修改虚拟机各项参数。")]),t._v(" "),a("p",[a("strong",[t._v("使用jps命令的-v参数可以查看虚拟机启动时显式指定的参数列表")]),t._v("，但如果想知道未被显式指定的参数的系统默认值，除了去找资料外，就只能使用jinfo的-flag选项进行查询了（如果只限于JDK 1.6或以上版本的话，使用java -XX:+PrintFlagsFinal查看参数默认值也是一个很好的选择）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/2021070716373839.jpg?",alt:"在这里插入图片描述"}})]),t._v(" "),a("p",[a("strong",[t._v("jinfo flags pid在高版本才能正常使用，我在jdk1.8这个版本不能正常使用")])]),t._v(" "),a("p",[t._v("应用程序设置如下参数")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xmx10m")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xms10m")]),t._v("\n")])])]),a("p",[t._v("查看最大堆内存和是否打印GC日志，可以看到不打印GC日志\n接着设置打印GC日志，再次查看，打印GC日志")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("peng"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@pengdeMacBook")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Pro")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" jinfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("flag "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MaxHeapSize")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20253")]),t._v("         \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MaxHeapSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10485760")]),t._v("\npeng"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@pengdeMacBook")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Pro")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" jinfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("flag "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCDetails")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20253")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCDetails")]),t._v("\npeng"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@pengdeMacBook")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Pro")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" jinfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("flag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCDetails")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20253")]),t._v("\npeng"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@pengdeMacBook")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Pro")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" jinfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("flag "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCDetails")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20253")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCDetails")]),t._v("\n")])])]),a("p",[a("strong",[t._v("Xmx是MaxHeapSize的别名")])])])}),[],!1,null,null,null);s.default=e.exports}}]);