(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{525:function(s,t,a){"use strict";a.r(t);var e=a(56),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"面试官-如何快速定位慢sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#面试官-如何快速定位慢sql"}},[s._v("#")]),s._v(" 面试官：如何快速定位慢SQL？")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210307201642561.jpg?",alt:"在这里插入图片描述"}})]),s._v(" "),a("h2",{attrs:{id:"开启慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启慢查询日志"}},[s._v("#")]),s._v(" 开启慢查询日志")]),s._v(" "),a("p",[s._v("在项目中我们会经常遇到慢查询，当我们遇到慢查询的时候一般都要开启慢查询日志，并且分析慢查询日志，找到慢sql，然后用explain来分析")]),s._v(" "),a("h3",{attrs:{id:"系统变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统变量"}},[s._v("#")]),s._v(" 系统变量")]),s._v(" "),a("p",[s._v("MySQL和慢查询相关的系统变量如下")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("参数")]),s._v(" "),a("th",[s._v("含义")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("slow_query_log")]),s._v(" "),a("td",[s._v("是否启用慢查询日志， ON为启用，OFF为没有启用，默认为OFF")])]),s._v(" "),a("tr",[a("td",[s._v("log_output")]),s._v(" "),a("td",[s._v("日志输出位置，默认为FILE，即保存为文件，若设置为TABLE，则将日志记录到mysql.show_log表中，支持设置多种格式")])]),s._v(" "),a("tr",[a("td",[s._v("slow_query_log_file")]),s._v(" "),a("td",[s._v("指定慢查询日志文件的路径和名字")])]),s._v(" "),a("tr",[a("td",[s._v("long_query_time")]),s._v(" "),a("td",[s._v("执行时间超过该值才记录到慢查询日志，单位为秒，默认为10")])])])]),s._v(" "),a("p",[s._v("执行如下语句看是否启用慢查询日志，ON为启用，OFF为没有启用")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%slow_query_log%"')]),s._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200308165100201.PNG",alt:"在这里插入图片描述"}}),s._v("\n可以看到我的没有启用，可以通过如下两种方式开启慢查询")]),s._v(" "),a("h3",{attrs:{id:"修改配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),a("p",[s._v("修改配置文件my.ini，在[mysqld]段落中加入如下参数")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("mysqld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("log_output")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("FILE,TABLE")]),s._v("'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("slow_query_log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("ON")]),s._v("'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("long_query_time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0.001")]),s._v("\n")])])]),a("p",[a("strong",[s._v("需要重启 MySQL 才可以生效，命令为 service mysqld restart")])]),s._v(" "),a("h3",{attrs:{id:"设置全局变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置全局变量"}},[s._v("#")]),s._v(" 设置全局变量")]),s._v(" "),a("p",[s._v("我在命令行中执行如下2句打开慢查询日志，设置超时时间为0.001s，并且将日志记录到文件以及mysql.slow_log表中")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" slow_query_log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" log_output "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'FILE,TABLE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" long_query_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[a("strong",[s._v("想要永久生效得到配置文件中配置，否则数据库重启后，这些配置失效")])]),s._v(" "),a("h2",{attrs:{id:"分析慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析慢查询日志"}},[s._v("#")]),s._v(" 分析慢查询日志")]),s._v(" "),a("p",[s._v("因为mysql慢查询日志相当于是一个流水账，并没有汇总统计的功能，所以我们需要用一些工具来分析一下")]),s._v(" "),a("h3",{attrs:{id:"mysqldumpslow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysqldumpslow"}},[s._v("#")]),s._v(" mysqldumpslow")]),s._v(" "),a("p",[s._v("mysql内置了mysqldumpslow这个工具来帮我们分析慢查询日志。\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210307202725788.png?",alt:"在这里插入图片描述"}})]),s._v(" "),a("p",[s._v("常见用法")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取出使用最多的10条慢查询")]),s._v("\nmysqldumpslow -s c -t "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" /var/run/mysqld/mysqld-slow.log\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取出查询时间最慢的3条慢查询")]),s._v("\nmysqldumpslow -s t -t "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" /var/run/mysqld/mysqld-slow.log \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 得到按照时间排序的前10条里面含有左连接的查询语句")]),s._v("\nmysqldumpslow -s t -t "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" -g “left join” /database/mysql/slow-log \n")])])]),a("h3",{attrs:{id:"pt-query-digest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pt-query-digest"}},[s._v("#")]),s._v(" pt-query-digest")]),s._v(" "),a("p",[s._v("pt-query-digest是我用的最多的一个工具，功能非常强大，可以分析binlog、General log、slowlog，也可以通过show processlist或者通过tcpdump抓取的MySQL协议数据来进行分析。pt-query-digest是一个perl脚本，只需下载并赋权即可执行")]),s._v(" "),a("h4",{attrs:{id:"下载和赋权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载和赋权"}},[s._v("#")]),s._v(" 下载和赋权")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" www.percona.com/get/pt-query-digest\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" u+x pt-query-digest\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /opt/soft/pt-query-digest /usr/bin/pt-query-digest\n")])])]),a("h4",{attrs:{id:"用法介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用法介绍"}},[s._v("#")]),s._v(" 用法介绍")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("// 查看具体使用方法 \npt-query-digest --help\n// 使用格式\npt-query-digest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("FILES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DSN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[a("strong",[s._v("常用OPTIONS")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("--create-review-table  当使用--review参数把分析结果输出到表中时，如果没有表就自动创建。\n--create-history-table  当使用--history参数把分析结果输出到表中时，如果没有表就自动创建。\n--filter  对输入的慢查询按指定的字符串进行匹配过滤后再进行分析\n--limit限制输出结果百分比或数量，默认值是20,即将最慢的20条语句输出，如果是50%则按总响应时间占比从大到小排序，输出到总和达到50%位置截止。\n--host  mysql服务器地址\n--user  mysql用户名\n--password  mysql用户密码\n--history 将分析结果保存到表中，分析结果比较详细，下次再使用--history时，如果存在相同的语句，且查询所在的时间区间和历史表中的不同，则会记录到数据表中，可以通过查询同一CHECKSUM来比较某类型查询的历史变化。\n--review 将分析结果保存到表中，这个分析只是对查询条件进行参数化，一个类型的查询一条记录，比较简单。当下次使用--review时，如果存在相同的语句分析，就不会记录到数据表中。\n--output 分析结果输出类型，值可以是report"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("标准分析报告"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("、slowlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Mysql slow log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("、json、json-anon，一般使用report，以便于阅读。\n--since 从什么时间开始分析，值为字符串，可以是指定的某个”yyyy-mm-dd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("hh:mm:ss"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("”格式的时间点，也可以是简单的一个时间值：s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("秒"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("、h"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("小时"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("、m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("分钟"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("、d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("天"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，如12h就表示从12小时前开始统计。\n--until 截止时间，配合—since可以分析一段时间内的慢查询。\n")])])]),a("p",[a("strong",[s._v("常用DSN")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("A    指定字符集\nD    指定连接的数据库\nP    连接数据库端口\nS    连接Socket "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\nh    连接数据库主机名\np    连接数据库的密码\nt    使用--review或--history时把数据存储到哪张表里\nu    连接数据库用户名\n")])])]),a("p",[s._v("DSN使用key=value的形式配置；多个DSN使用,分隔")]),s._v(" "),a("p",[a("strong",[s._v("使用示例")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 展示slow.log中最慢的查询的报表")]),s._v("\npt-query-digest slow.log\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分析最近12小时内的查询")]),s._v("\npt-query-digest --since"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("12h slow.log\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分析指定范围内的查询")]),s._v("\npt-query-digest slow.log --since "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-20 00:00:00'")]),s._v(" --until "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-25 00:00:00'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把slow.log中查询保存到query_history表")]),s._v("\npt-query-digest --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root --password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root123 --review "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("h")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("localhost,D"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test,t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("query_history --create-review-table slow.log\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连上localhost，并读取processlist，输出到slowlog")]),s._v("\npt-query-digest --processlist "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("h")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("localhost --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root --password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root123 --interval"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" --output slowlog\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 利用tcpdump获取MySQL协议数据，然后产生最慢查询的报表")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcpdump使用说明：https://blog.csdn.net/chinaltx/article/details/87469933")]),s._v("\ntcpdump -s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v(" -x -nn -q -tttt -i any -c "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mysql.tcp.txt\npt-query-digest --type tcpdump mysql.tcp.txt\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分析binlog")]),s._v("\nmysqlbinlog mysql-bin.000093 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mysql-bin000093.sql\npt-query-digest  --type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("binlog mysql-bin000093.sql\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分析general log")]),s._v("\npt-query-digest  --type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("genlog  localhost.log\n")])])]),a("h4",{attrs:{id:"用法实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用法实战"}},[s._v("#")]),s._v(" 用法实战")]),s._v(" "),a("p",[a("strong",[s._v("编写存储过程批量造数据")])]),s._v(" "),a("p",[s._v("在实际工作中没有测试性能，我们经常需要改造大批量的数据，手动插入是不太可能的，这时候就得用到存储过程了")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("kf_user_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("gid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'客服组id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'客服名字'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'客户信息表'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("如何定义一个存储过程呢？")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" 存储过程名称 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("参数列表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n    需要执行的语句\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n")])])]),a("p",[s._v("举个例子，插入id为1-100000的100000条数据")]),s._v(" "),a("p",[s._v("用Navicat执行")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 删除之前定义的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXISTS")]),s._v(" create_kf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 开始定义")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" create_kf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" loop_times "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" loop_times "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DO")]),s._v("    \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" kf_user_info "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("gid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" var"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 调用")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" create_kf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("存储过程的三种参数类型")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("参数类型")]),s._v(" "),a("th",[s._v("是否返回")]),s._v(" "),a("th",[s._v("作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("IN")]),s._v(" "),a("td",[s._v("否")]),s._v(" "),a("td",[s._v("向存储过程传入参数，存储过程中修改该参数的值，不能被返回")])]),s._v(" "),a("tr",[a("td",[s._v("OUT")]),s._v(" "),a("td",[s._v("是")]),s._v(" "),a("td",[s._v("把存储过程计算的结果放到该参数中，调用者可以得到返回值")])]),s._v(" "),a("tr",[a("td",[s._v("INOUT")]),s._v(" "),a("td",[s._v("是")]),s._v(" "),a("td",[s._v("IN和OUT的结合，即用于存储过程的传入参数，同时又可以把计算结构放到参数中，调用者可以得到返回值")])])])]),s._v(" "),a("p",[s._v("用MySQL执行")]),s._v(" "),a("p",[s._v("得用DELIMITER 定义新的结束符，因为默认情况下SQL采用（;）作为结束符，这样当存储过程中的每一句SQL结束之后，采用（；）作为结束符，就相当于告诉MySQL可以执行这一句了。但是存储过程是一个整体，我们不希望SQL逐条执行，而是采用存储过程整段执行的方式，因此我们就需要定义新的DELIMITER ，新的结束符可以用（//）或者（$$）")]),s._v(" "),a("p",[s._v("因为上面的代码应该就改为如下这种方式")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" create_kf_kfGroup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" loop_times "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" loop_times "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DO")]),s._v("    \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" kf_user_info "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("gid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" var"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])])]),a("p",[s._v("查询已经定义的存储过程")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[a("strong",[s._v("开始执行慢sql")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" kf_user_info "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9999")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" kf_user_info "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99999")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" kf_user_info "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" gid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" kf_user_info "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" gid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("可以执行如下sql查看慢sql的相关信息。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slow_log "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" start_time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("查看一下慢日志存储位置")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"slow_query_log_file"')]),s._v("\n")])])]),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("pt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("query"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("digest "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("VM"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("centos"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n")])])]),a("p",[s._v("执行后的文件如下\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210320210305628.png?",alt:"在这里插入图片描述"}})]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Profile")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Rank Query ID                            Response time Calls R/Call V/M ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==== =================================== ============= ===== ====== ====")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    1 0xE2566F6154AFF41948FE497E53631B43   0.1480 56.1%     4 0.0370  0.00 UPDATE kf_user_info")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    2 0x2DFBC6DBF0D68EF2EC2AE954DC37A1A4   0.1109 42.1%     4 0.0277  0.00 SELECT kf_user_info")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MISC 0xMISC                               0.0047  1.8%     2 0.0024   0.0 <2 ITEMS>")]),s._v("\n")])])]),a("p",[s._v("从最上面的统计sql中就可以看到执行慢的sql")]),s._v(" "),a("p",[s._v("可以看到响应时间，执行次数，每次执行耗时（单位秒），执行的sql")]),s._v(" "),a("p",[s._v("下面就是各个慢sql的详细分析，比如，执行时间，获取锁的时间，执行时间分布，所在的表等信息")]),s._v(" "),a("p",[a("strong",[s._v("不由得感叹一声，真是神器，查看慢sql超级方便")])]),s._v(" "),a("p",[s._v("最后说一个我遇到的一个有意思的问题，有一段时间线上的接口特别慢，但是我查日志发现sql执行的很快，难道是网络的问题？")]),s._v(" "),a("p",[s._v("为了确定是否是网络的问题，我就用拦截器看了一下接口的执行时间，发现耗时很长，考虑到方法加了事务，难道是事务提交很慢？")]),s._v(" "),a("p",[s._v("于是我用pt-query-digest统计了一下1分钟左右的慢日志，发现事务提交的次很多，但是每次提交事务的平均时长是1.4s左右，果然是事务提交很慢。\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/2021032021260033.png?",alt:"在这里插入图片描述"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);