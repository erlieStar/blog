<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka 消息存储 | Java识堂</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/egg.png">
    <script>
                var _hmt = _hmt || [];
                (function() {
                    var hm = document.createElement("script");
                    hm.src = "https://hm.baidu.com/hm.js?0784d635689a6d6b5b6c15db0b223263";
                    var s = document.getElementsByTagName("script")[0]; 
                    s.parentNode.insertBefore(hm, s);
                })();
            </script>
    <meta name="description" content="Java识堂">
    <meta id="referrer" name="referrer" content="never">
    
    <link rel="preload" href="/blog/assets/css/0.styles.940ff0ec.css" as="style"><link rel="preload" href="/blog/assets/js/app.c036f1e4.js" as="script"><link rel="preload" href="/blog/assets/js/2.9b5c8eec.js" as="script"><link rel="preload" href="/blog/assets/js/179.1f8c84d1.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.5168f783.js"><link rel="prefetch" href="/blog/assets/js/100.d4f06733.js"><link rel="prefetch" href="/blog/assets/js/101.d6f6c131.js"><link rel="prefetch" href="/blog/assets/js/102.ef0d6d8b.js"><link rel="prefetch" href="/blog/assets/js/103.04681fb1.js"><link rel="prefetch" href="/blog/assets/js/104.90fffcd0.js"><link rel="prefetch" href="/blog/assets/js/105.844355ad.js"><link rel="prefetch" href="/blog/assets/js/106.589ccf67.js"><link rel="prefetch" href="/blog/assets/js/107.a83783d5.js"><link rel="prefetch" href="/blog/assets/js/108.e8291e87.js"><link rel="prefetch" href="/blog/assets/js/109.1318526c.js"><link rel="prefetch" href="/blog/assets/js/11.aaf53676.js"><link rel="prefetch" href="/blog/assets/js/110.4707a1da.js"><link rel="prefetch" href="/blog/assets/js/111.fa0e5906.js"><link rel="prefetch" href="/blog/assets/js/112.9ca42cce.js"><link rel="prefetch" href="/blog/assets/js/113.506d8fe5.js"><link rel="prefetch" href="/blog/assets/js/114.3b9d1d2e.js"><link rel="prefetch" href="/blog/assets/js/115.f4573ac6.js"><link rel="prefetch" href="/blog/assets/js/116.1b535bfb.js"><link rel="prefetch" href="/blog/assets/js/117.eb06078c.js"><link rel="prefetch" href="/blog/assets/js/118.307aad3b.js"><link rel="prefetch" href="/blog/assets/js/119.75a83853.js"><link rel="prefetch" href="/blog/assets/js/12.2f9a9e59.js"><link rel="prefetch" href="/blog/assets/js/120.8ae70204.js"><link rel="prefetch" href="/blog/assets/js/121.dabd9b9a.js"><link rel="prefetch" href="/blog/assets/js/122.88e97c8b.js"><link rel="prefetch" href="/blog/assets/js/123.95042c29.js"><link rel="prefetch" href="/blog/assets/js/124.ac50eeca.js"><link rel="prefetch" href="/blog/assets/js/125.e5ab5b95.js"><link rel="prefetch" href="/blog/assets/js/126.87b83746.js"><link rel="prefetch" href="/blog/assets/js/127.cbba70b5.js"><link rel="prefetch" href="/blog/assets/js/128.7703da5a.js"><link rel="prefetch" href="/blog/assets/js/129.8cb5942f.js"><link rel="prefetch" href="/blog/assets/js/13.c3eb5486.js"><link rel="prefetch" href="/blog/assets/js/130.d9e95695.js"><link rel="prefetch" href="/blog/assets/js/131.3963a36e.js"><link rel="prefetch" href="/blog/assets/js/132.b06a28cf.js"><link rel="prefetch" href="/blog/assets/js/133.d54739c6.js"><link rel="prefetch" href="/blog/assets/js/134.26447814.js"><link rel="prefetch" href="/blog/assets/js/135.2cf3b882.js"><link rel="prefetch" href="/blog/assets/js/136.2d25ad40.js"><link rel="prefetch" href="/blog/assets/js/137.ff73190d.js"><link rel="prefetch" href="/blog/assets/js/138.5ab7ddd4.js"><link rel="prefetch" href="/blog/assets/js/139.6363b2b7.js"><link rel="prefetch" href="/blog/assets/js/14.9ab2b138.js"><link rel="prefetch" href="/blog/assets/js/140.a44af731.js"><link rel="prefetch" href="/blog/assets/js/141.5a509d42.js"><link rel="prefetch" href="/blog/assets/js/142.d5d66e19.js"><link rel="prefetch" href="/blog/assets/js/143.358da913.js"><link rel="prefetch" href="/blog/assets/js/144.6e67c3c3.js"><link rel="prefetch" href="/blog/assets/js/145.4c82fa54.js"><link rel="prefetch" href="/blog/assets/js/146.7c16cddf.js"><link rel="prefetch" href="/blog/assets/js/147.3f948477.js"><link rel="prefetch" href="/blog/assets/js/148.01e09a6b.js"><link rel="prefetch" href="/blog/assets/js/149.c21730da.js"><link rel="prefetch" href="/blog/assets/js/15.80ea4719.js"><link rel="prefetch" href="/blog/assets/js/150.37034827.js"><link rel="prefetch" href="/blog/assets/js/151.15cf7db4.js"><link rel="prefetch" href="/blog/assets/js/152.9469a6f6.js"><link rel="prefetch" href="/blog/assets/js/153.e99167b8.js"><link rel="prefetch" href="/blog/assets/js/154.50565997.js"><link rel="prefetch" href="/blog/assets/js/155.1e819230.js"><link rel="prefetch" href="/blog/assets/js/156.283bb7cb.js"><link rel="prefetch" href="/blog/assets/js/157.0f4ccad1.js"><link rel="prefetch" href="/blog/assets/js/158.86219ced.js"><link rel="prefetch" href="/blog/assets/js/159.9291d099.js"><link rel="prefetch" href="/blog/assets/js/16.3c4cb577.js"><link rel="prefetch" href="/blog/assets/js/160.a7197580.js"><link rel="prefetch" href="/blog/assets/js/161.bcbc8f2c.js"><link rel="prefetch" href="/blog/assets/js/162.f05dd964.js"><link rel="prefetch" href="/blog/assets/js/163.f6f7196b.js"><link rel="prefetch" href="/blog/assets/js/164.786e7a7a.js"><link rel="prefetch" href="/blog/assets/js/165.88ecf391.js"><link rel="prefetch" href="/blog/assets/js/166.77d7b0be.js"><link rel="prefetch" href="/blog/assets/js/167.2f09c096.js"><link rel="prefetch" href="/blog/assets/js/168.9f33285b.js"><link rel="prefetch" href="/blog/assets/js/169.c3db3391.js"><link rel="prefetch" href="/blog/assets/js/17.c951fa2e.js"><link rel="prefetch" href="/blog/assets/js/170.17d01e25.js"><link rel="prefetch" href="/blog/assets/js/171.bc72096c.js"><link rel="prefetch" href="/blog/assets/js/172.f0980b9a.js"><link rel="prefetch" href="/blog/assets/js/173.98c9c243.js"><link rel="prefetch" href="/blog/assets/js/174.b9e047fc.js"><link rel="prefetch" href="/blog/assets/js/175.a038bc32.js"><link rel="prefetch" href="/blog/assets/js/176.2a8a1955.js"><link rel="prefetch" href="/blog/assets/js/177.c74267f5.js"><link rel="prefetch" href="/blog/assets/js/178.fa87b3af.js"><link rel="prefetch" href="/blog/assets/js/18.41379d44.js"><link rel="prefetch" href="/blog/assets/js/180.f9f7f083.js"><link rel="prefetch" href="/blog/assets/js/181.eda3ad60.js"><link rel="prefetch" href="/blog/assets/js/182.954d5622.js"><link rel="prefetch" href="/blog/assets/js/183.2c8d9c40.js"><link rel="prefetch" href="/blog/assets/js/184.e9dac2d8.js"><link rel="prefetch" href="/blog/assets/js/185.56492778.js"><link rel="prefetch" href="/blog/assets/js/186.3e360509.js"><link rel="prefetch" href="/blog/assets/js/187.22d09b54.js"><link rel="prefetch" href="/blog/assets/js/188.87834b91.js"><link rel="prefetch" href="/blog/assets/js/189.6f487a44.js"><link rel="prefetch" href="/blog/assets/js/19.89527945.js"><link rel="prefetch" href="/blog/assets/js/190.027c5d40.js"><link rel="prefetch" href="/blog/assets/js/191.d7d2c42b.js"><link rel="prefetch" href="/blog/assets/js/192.e909164f.js"><link rel="prefetch" href="/blog/assets/js/193.12a9d348.js"><link rel="prefetch" href="/blog/assets/js/194.43c0b424.js"><link rel="prefetch" href="/blog/assets/js/195.e28a4ac3.js"><link rel="prefetch" href="/blog/assets/js/196.b5f0c9b3.js"><link rel="prefetch" href="/blog/assets/js/197.82b442d9.js"><link rel="prefetch" href="/blog/assets/js/198.fd3e92bf.js"><link rel="prefetch" href="/blog/assets/js/199.db6615e4.js"><link rel="prefetch" href="/blog/assets/js/20.b16805b0.js"><link rel="prefetch" href="/blog/assets/js/200.2717ad1f.js"><link rel="prefetch" href="/blog/assets/js/201.0e4a91e6.js"><link rel="prefetch" href="/blog/assets/js/202.3df5db7f.js"><link rel="prefetch" href="/blog/assets/js/203.aa83fa42.js"><link rel="prefetch" href="/blog/assets/js/204.1ac5c8d1.js"><link rel="prefetch" href="/blog/assets/js/205.2ccad2a4.js"><link rel="prefetch" href="/blog/assets/js/206.d7c9d38f.js"><link rel="prefetch" href="/blog/assets/js/207.8f7d276e.js"><link rel="prefetch" href="/blog/assets/js/208.1b966e18.js"><link rel="prefetch" href="/blog/assets/js/209.cec7007a.js"><link rel="prefetch" href="/blog/assets/js/21.ccab0603.js"><link rel="prefetch" href="/blog/assets/js/210.eb3b245e.js"><link rel="prefetch" href="/blog/assets/js/211.fc48c627.js"><link rel="prefetch" href="/blog/assets/js/212.8b023a3f.js"><link rel="prefetch" href="/blog/assets/js/213.c496f5c3.js"><link rel="prefetch" href="/blog/assets/js/214.874a981b.js"><link rel="prefetch" href="/blog/assets/js/215.2d0acf9a.js"><link rel="prefetch" href="/blog/assets/js/216.2fa2d98a.js"><link rel="prefetch" href="/blog/assets/js/217.c359d26a.js"><link rel="prefetch" href="/blog/assets/js/218.fce595a5.js"><link rel="prefetch" href="/blog/assets/js/219.66c4e806.js"><link rel="prefetch" href="/blog/assets/js/22.a911a5c0.js"><link rel="prefetch" href="/blog/assets/js/220.33d3924a.js"><link rel="prefetch" href="/blog/assets/js/221.26add8cb.js"><link rel="prefetch" href="/blog/assets/js/222.dd6c20f4.js"><link rel="prefetch" href="/blog/assets/js/223.33c4f443.js"><link rel="prefetch" href="/blog/assets/js/224.675c8bcc.js"><link rel="prefetch" href="/blog/assets/js/225.96ae6ca9.js"><link rel="prefetch" href="/blog/assets/js/226.dbf291a9.js"><link rel="prefetch" href="/blog/assets/js/227.ea2963d3.js"><link rel="prefetch" href="/blog/assets/js/228.e6b665bc.js"><link rel="prefetch" href="/blog/assets/js/229.205eaed7.js"><link rel="prefetch" href="/blog/assets/js/23.c88838b6.js"><link rel="prefetch" href="/blog/assets/js/230.f448fbd7.js"><link rel="prefetch" href="/blog/assets/js/231.1d78dff7.js"><link rel="prefetch" href="/blog/assets/js/232.c44f3715.js"><link rel="prefetch" href="/blog/assets/js/233.86f75186.js"><link rel="prefetch" href="/blog/assets/js/234.fec613ec.js"><link rel="prefetch" href="/blog/assets/js/235.3331e8df.js"><link rel="prefetch" href="/blog/assets/js/236.84c676e8.js"><link rel="prefetch" href="/blog/assets/js/237.73a36136.js"><link rel="prefetch" href="/blog/assets/js/238.374e5e33.js"><link rel="prefetch" href="/blog/assets/js/239.a73700cb.js"><link rel="prefetch" href="/blog/assets/js/24.abbd284e.js"><link rel="prefetch" href="/blog/assets/js/240.ec188846.js"><link rel="prefetch" href="/blog/assets/js/241.a1b37a71.js"><link rel="prefetch" href="/blog/assets/js/242.d93e7558.js"><link rel="prefetch" href="/blog/assets/js/243.a15d739c.js"><link rel="prefetch" href="/blog/assets/js/244.144a9728.js"><link rel="prefetch" href="/blog/assets/js/245.6d22fc3c.js"><link rel="prefetch" href="/blog/assets/js/246.fb50eb3b.js"><link rel="prefetch" href="/blog/assets/js/247.0327f198.js"><link rel="prefetch" href="/blog/assets/js/248.6fc98a88.js"><link rel="prefetch" href="/blog/assets/js/249.5599a3c1.js"><link rel="prefetch" href="/blog/assets/js/25.aec1aca4.js"><link rel="prefetch" href="/blog/assets/js/250.43862e55.js"><link rel="prefetch" href="/blog/assets/js/251.b81743c1.js"><link rel="prefetch" href="/blog/assets/js/252.26d35bd1.js"><link rel="prefetch" href="/blog/assets/js/253.bebb95ec.js"><link rel="prefetch" href="/blog/assets/js/254.f456f914.js"><link rel="prefetch" href="/blog/assets/js/255.647813c7.js"><link rel="prefetch" href="/blog/assets/js/256.ea186e98.js"><link rel="prefetch" href="/blog/assets/js/257.e5847548.js"><link rel="prefetch" href="/blog/assets/js/258.078ca562.js"><link rel="prefetch" href="/blog/assets/js/259.da85b560.js"><link rel="prefetch" href="/blog/assets/js/26.ec3b11e6.js"><link rel="prefetch" href="/blog/assets/js/260.53a943c0.js"><link rel="prefetch" href="/blog/assets/js/261.e00e2086.js"><link rel="prefetch" href="/blog/assets/js/262.e2610b3e.js"><link rel="prefetch" href="/blog/assets/js/263.ca8192c2.js"><link rel="prefetch" href="/blog/assets/js/264.463b8b36.js"><link rel="prefetch" href="/blog/assets/js/265.9aff467c.js"><link rel="prefetch" href="/blog/assets/js/266.eb627ec9.js"><link rel="prefetch" href="/blog/assets/js/267.9370481e.js"><link rel="prefetch" href="/blog/assets/js/268.216154e9.js"><link rel="prefetch" href="/blog/assets/js/269.d0f2e156.js"><link rel="prefetch" href="/blog/assets/js/27.59e066d7.js"><link rel="prefetch" href="/blog/assets/js/270.13b291da.js"><link rel="prefetch" href="/blog/assets/js/271.af4913b7.js"><link rel="prefetch" href="/blog/assets/js/272.c6ba6883.js"><link rel="prefetch" href="/blog/assets/js/273.8005137c.js"><link rel="prefetch" href="/blog/assets/js/274.2655f1a5.js"><link rel="prefetch" href="/blog/assets/js/275.ad0ceb56.js"><link rel="prefetch" href="/blog/assets/js/276.a64ed2c8.js"><link rel="prefetch" href="/blog/assets/js/277.f1e069ec.js"><link rel="prefetch" href="/blog/assets/js/278.654dfc91.js"><link rel="prefetch" href="/blog/assets/js/279.84db6b00.js"><link rel="prefetch" href="/blog/assets/js/28.0a2803ef.js"><link rel="prefetch" href="/blog/assets/js/280.57e602e5.js"><link rel="prefetch" href="/blog/assets/js/281.2cf707ce.js"><link rel="prefetch" href="/blog/assets/js/282.7847cb28.js"><link rel="prefetch" href="/blog/assets/js/283.174d9bfa.js"><link rel="prefetch" href="/blog/assets/js/284.7ea9371d.js"><link rel="prefetch" href="/blog/assets/js/285.5af79dbc.js"><link rel="prefetch" href="/blog/assets/js/286.857e65dc.js"><link rel="prefetch" href="/blog/assets/js/287.1bbdde1b.js"><link rel="prefetch" href="/blog/assets/js/288.f105af8f.js"><link rel="prefetch" href="/blog/assets/js/289.270f4884.js"><link rel="prefetch" href="/blog/assets/js/29.14223dfd.js"><link rel="prefetch" href="/blog/assets/js/290.d6e95ac4.js"><link rel="prefetch" href="/blog/assets/js/291.d8b846af.js"><link rel="prefetch" href="/blog/assets/js/292.280a792b.js"><link rel="prefetch" href="/blog/assets/js/293.f60bea60.js"><link rel="prefetch" href="/blog/assets/js/294.362e2351.js"><link rel="prefetch" href="/blog/assets/js/295.159a87b0.js"><link rel="prefetch" href="/blog/assets/js/296.25eaca27.js"><link rel="prefetch" href="/blog/assets/js/297.17328991.js"><link rel="prefetch" href="/blog/assets/js/298.582c41f6.js"><link rel="prefetch" href="/blog/assets/js/299.ce44b730.js"><link rel="prefetch" href="/blog/assets/js/3.415d1578.js"><link rel="prefetch" href="/blog/assets/js/30.0ad34444.js"><link rel="prefetch" href="/blog/assets/js/300.65be9a52.js"><link rel="prefetch" href="/blog/assets/js/301.24b975e5.js"><link rel="prefetch" href="/blog/assets/js/302.a18aa513.js"><link rel="prefetch" href="/blog/assets/js/303.9ea90e52.js"><link rel="prefetch" href="/blog/assets/js/31.0a80fc70.js"><link rel="prefetch" href="/blog/assets/js/32.83d051ec.js"><link rel="prefetch" href="/blog/assets/js/33.47ba411a.js"><link rel="prefetch" href="/blog/assets/js/34.51e5f91d.js"><link rel="prefetch" href="/blog/assets/js/35.6d74a942.js"><link rel="prefetch" href="/blog/assets/js/36.a27f4a1a.js"><link rel="prefetch" href="/blog/assets/js/37.442ef1ab.js"><link rel="prefetch" href="/blog/assets/js/38.ef8468a7.js"><link rel="prefetch" href="/blog/assets/js/39.f09d3e81.js"><link rel="prefetch" href="/blog/assets/js/4.259bde72.js"><link rel="prefetch" href="/blog/assets/js/40.0de8e5df.js"><link rel="prefetch" href="/blog/assets/js/41.13782b0e.js"><link rel="prefetch" href="/blog/assets/js/42.61c76fed.js"><link rel="prefetch" href="/blog/assets/js/43.67f7a54c.js"><link rel="prefetch" href="/blog/assets/js/44.2981b45f.js"><link rel="prefetch" href="/blog/assets/js/45.6d68e6d5.js"><link rel="prefetch" href="/blog/assets/js/46.c2a61055.js"><link rel="prefetch" href="/blog/assets/js/47.32fcb215.js"><link rel="prefetch" href="/blog/assets/js/48.b2166a59.js"><link rel="prefetch" href="/blog/assets/js/49.47c0c37c.js"><link rel="prefetch" href="/blog/assets/js/5.22499ca9.js"><link rel="prefetch" href="/blog/assets/js/50.0fa9f7ef.js"><link rel="prefetch" href="/blog/assets/js/51.fc995e78.js"><link rel="prefetch" href="/blog/assets/js/52.e78925e2.js"><link rel="prefetch" href="/blog/assets/js/53.256139b3.js"><link rel="prefetch" href="/blog/assets/js/54.0f627544.js"><link rel="prefetch" href="/blog/assets/js/55.e315b0b3.js"><link rel="prefetch" href="/blog/assets/js/56.096b3b41.js"><link rel="prefetch" href="/blog/assets/js/57.6a2b68ff.js"><link rel="prefetch" href="/blog/assets/js/58.ab74862f.js"><link rel="prefetch" href="/blog/assets/js/59.68840e09.js"><link rel="prefetch" href="/blog/assets/js/6.8ce66f47.js"><link rel="prefetch" href="/blog/assets/js/60.4ac005d7.js"><link rel="prefetch" href="/blog/assets/js/61.573f5ae7.js"><link rel="prefetch" href="/blog/assets/js/62.b417927f.js"><link rel="prefetch" href="/blog/assets/js/63.0ee1359f.js"><link rel="prefetch" href="/blog/assets/js/64.62fd31b8.js"><link rel="prefetch" href="/blog/assets/js/65.07201bb1.js"><link rel="prefetch" href="/blog/assets/js/66.7219223d.js"><link rel="prefetch" href="/blog/assets/js/67.870044e5.js"><link rel="prefetch" href="/blog/assets/js/68.0a5a1cd9.js"><link rel="prefetch" href="/blog/assets/js/69.fca2a561.js"><link rel="prefetch" href="/blog/assets/js/7.6b3059d4.js"><link rel="prefetch" href="/blog/assets/js/70.155e51ef.js"><link rel="prefetch" href="/blog/assets/js/71.37742319.js"><link rel="prefetch" href="/blog/assets/js/72.d60b1345.js"><link rel="prefetch" href="/blog/assets/js/73.3b152cc8.js"><link rel="prefetch" href="/blog/assets/js/74.10819fab.js"><link rel="prefetch" href="/blog/assets/js/75.4f5cfdb2.js"><link rel="prefetch" href="/blog/assets/js/76.a83ff882.js"><link rel="prefetch" href="/blog/assets/js/77.59ca5ee5.js"><link rel="prefetch" href="/blog/assets/js/78.97000c68.js"><link rel="prefetch" href="/blog/assets/js/79.0330edc0.js"><link rel="prefetch" href="/blog/assets/js/8.9362fbcf.js"><link rel="prefetch" href="/blog/assets/js/80.4b880525.js"><link rel="prefetch" href="/blog/assets/js/81.fd184cf8.js"><link rel="prefetch" href="/blog/assets/js/82.70f75d11.js"><link rel="prefetch" href="/blog/assets/js/83.92744e9f.js"><link rel="prefetch" href="/blog/assets/js/84.c904562e.js"><link rel="prefetch" href="/blog/assets/js/85.c4dea2ac.js"><link rel="prefetch" href="/blog/assets/js/86.41106b77.js"><link rel="prefetch" href="/blog/assets/js/87.143dd3f2.js"><link rel="prefetch" href="/blog/assets/js/88.01824d32.js"><link rel="prefetch" href="/blog/assets/js/89.f3769ba8.js"><link rel="prefetch" href="/blog/assets/js/9.8b2acba6.js"><link rel="prefetch" href="/blog/assets/js/90.e6ca01a1.js"><link rel="prefetch" href="/blog/assets/js/91.e4d58db5.js"><link rel="prefetch" href="/blog/assets/js/92.e5bb80b9.js"><link rel="prefetch" href="/blog/assets/js/93.0e0ec734.js"><link rel="prefetch" href="/blog/assets/js/94.a3579856.js"><link rel="prefetch" href="/blog/assets/js/95.5ba6794f.js"><link rel="prefetch" href="/blog/assets/js/96.3bcf511b.js"><link rel="prefetch" href="/blog/assets/js/97.a087bcd5.js"><link rel="prefetch" href="/blog/assets/js/98.4961ead2.js"><link rel="prefetch" href="/blog/assets/js/99.2036e4f2.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.940ff0ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Java识堂</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/md/other/guide.html" class="nav-link">
  导读
</a></div><div class="nav-item"><a href="/blog/md/algorithm/开篇：拒绝盲目刷题，如何更高效的学习算法.html" class="nav-link">
  算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/java/说一下八种基本数据类型及其包装类吧.html" class="nav-link">
  Java面试
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/concurrent/Synchronized底层实现，锁升级原理.html" class="nav-link">
  Java并发
</a></li></ul></div></div><div class="nav-item"><a href="/blog/md/jvm/常见的垃圾回收算法有哪些.html" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/md/spring/Spring容器启动流程.html" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/blog/md/mybatis/JDBC用法一览.html" class="nav-link">
  Mybatis
</a></div><div class="nav-item"><a href="/blog/md/redis/Redis数据结构为什么既省内存又高效.html" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/blog/md/mysql/数据是如何进行存储和查询的.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MQ" class="dropdown-title"><span class="title">MQ</span> <span class="arrow down"></span></button> <button type="button" aria-label="MQ" class="mobile-dropdown-title"><span class="title">MQ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/kafka/Kafka集群搭建.html" class="nav-link">
  Kafka
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/rocketmq/消息发送和消费核心流程汇总.html" class="nav-link">
  RocketMq
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/rabbitmq/消息中间件的诸侯征战史.html" class="nav-link">
  RabbitMq
</a></li></ul></div></div><div class="nav-item"><a href="/blog/md/elasticsearch/ElasticSearch集群搭建.html" class="nav-link">
  ElasticSearch
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/transaction/01.7种常见解决方案汇总.html" class="nav-link">
  分布式事务
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/seata/01.seata和spring是如何整合的.html" class="nav-link">
  Seata
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="RPC" class="dropdown-title"><span class="title">RPC</span> <span class="arrow down"></span></button> <button type="button" aria-label="RPC" class="mobile-dropdown-title"><span class="title">RPC</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/rpc/如何手写一个RPC框架.html" class="nav-link">
  手写RPC
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/dubbo/Dubbo的前世今生.html" class="nav-link">
  Dubbo
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/md/other/guide.html" class="nav-link">
  导读
</a></div><div class="nav-item"><a href="/blog/md/algorithm/开篇：拒绝盲目刷题，如何更高效的学习算法.html" class="nav-link">
  算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/java/说一下八种基本数据类型及其包装类吧.html" class="nav-link">
  Java面试
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/concurrent/Synchronized底层实现，锁升级原理.html" class="nav-link">
  Java并发
</a></li></ul></div></div><div class="nav-item"><a href="/blog/md/jvm/常见的垃圾回收算法有哪些.html" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/md/spring/Spring容器启动流程.html" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/blog/md/mybatis/JDBC用法一览.html" class="nav-link">
  Mybatis
</a></div><div class="nav-item"><a href="/blog/md/redis/Redis数据结构为什么既省内存又高效.html" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/blog/md/mysql/数据是如何进行存储和查询的.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MQ" class="dropdown-title"><span class="title">MQ</span> <span class="arrow down"></span></button> <button type="button" aria-label="MQ" class="mobile-dropdown-title"><span class="title">MQ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/kafka/Kafka集群搭建.html" class="nav-link">
  Kafka
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/rocketmq/消息发送和消费核心流程汇总.html" class="nav-link">
  RocketMq
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/rabbitmq/消息中间件的诸侯征战史.html" class="nav-link">
  RabbitMq
</a></li></ul></div></div><div class="nav-item"><a href="/blog/md/elasticsearch/ElasticSearch集群搭建.html" class="nav-link">
  ElasticSearch
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/transaction/01.7种常见解决方案汇总.html" class="nav-link">
  分布式事务
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/seata/01.seata和spring是如何整合的.html" class="nav-link">
  Seata
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="RPC" class="dropdown-title"><span class="title">RPC</span> <span class="arrow down"></span></button> <button type="button" aria-label="RPC" class="mobile-dropdown-title"><span class="title">RPC</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/rpc/如何手写一个RPC框架.html" class="nav-link">
  手写RPC
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/dubbo/Dubbo的前世今生.html" class="nav-link">
  Dubbo
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Kafka</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/md/kafka/Kafka集群搭建.html" class="sidebar-link">Kafka 集群搭建</a></li><li><a href="/blog/md/kafka/Kafka消息存储.html" class="active sidebar-link">Kafka 消息存储</a></li><li><a href="/blog/md/kafka/Kafka消息发送.html" class="sidebar-link">Kafka 消息发送</a></li><li><a href="/blog/md/kafka/Kafka消息消费.html" class="sidebar-link">Kafka 消息消费</a></li><li><a href="/blog/md/kafka/Kafka线上问题.html" class="sidebar-link">Kafka 线上问题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kafka-消息存储"><a href="#kafka-消息存储" class="header-anchor">#</a> Kafka 消息存储</h1> <p><img src="https://img-blog.csdnimg.cn/direct/0516c1407a804a59962b942b3370903c.png" alt="在这里插入图片描述"></p> <h2 id="请求处理"><a href="#请求处理" class="header-anchor">#</a> 请求处理</h2> <p>Kafka 的中的通信是基于 TCP 进行的，应用层的协议是 Kafka 自定义的。</p> <p><strong>Kafka Broker 是如何处理海量用户请求的？</strong></p> <p>基于 Reactor 模式，如下图所示
<img src="https://img-blog.csdnimg.cn/direct/16ae7dc676ae4fa5a0059849134a7d39.png" alt="在这里插入图片描述"></p> <p>Acceptor 监听建立连接事件，然后将连接转交给 Processor，让 Processor 监听读写事件，处理后返回对应的结果。</p> <p>Processor 会监听多个 socket 读写的请求，放入请求队列，同时监听自己的响应队列，把响应拿出来通过 socket 连接发送回客户端</p> <p>KafkaRequestHandler 线程池不停的从请求队列中获取请求来处理，这个线程池的默认大小为8个，由 num.io.threads 来控制，处理完请求后的响应，会放入每个 Processor 自己的响应队列中</p> <table><thead><tr><th>参数名</th> <th>描述</th> <th>默认值</th></tr></thead> <tbody><tr><td>num.network.threads</td> <td>processor 线程的数量</td> <td>3</td></tr> <tr><td>queued.max.requests</td> <td>broker 全局唯一的请求队列，用来保存请求</td> <td>500</td></tr> <tr><td>num.io.threads</td> <td>用来处理请求的线程数</td> <td>8</td></tr></tbody></table> <h2 id="kafka-消息读写"><a href="#kafka-消息读写" class="header-anchor">#</a> Kafka 消息读写</h2> <p>为了保证高可用和高性能，Kafka 会将 一个 topic下的消息 分为多个 partition，存到不同的 broker 上，为了实现负载均衡，Kafka 会尽量把 leader partition 均匀分布在集群各个机器上
<img src="https://img-blog.csdnimg.cn/direct/f6c4912664a046d0a98a7bcb51bc64d8.png" alt="在这里插入图片描述"></p> <p>创建 topic时，Kafka 为该 topic 的每个分区在文件系统中创建一个对应的文件夹，文件夹名字的格式为&lt;topic&gt;-&lt;分区号&gt;，假如有一个 topic 名为 order，有两个分区，文件系统会在对应的 broker 上创建2个文件夹 order-0 和 order-1，文件夹中的文件如下图所示
<img src="https://img-blog.csdnimg.cn/direct/9694b7511f0a4165b3c834539aef1fee.png" alt="在这里插入图片描述"></p> <p>文件名为消息起始的offset，这样就能通过文件名快速找到对应的消息</p> <table><thead><tr><th>文件</th> <th>作用</th></tr></thead> <tbody><tr><td>*.log</td> <td>日志文件，存储消息</td></tr> <tr><td>*.index</td> <td>索引文件，存储偏移量索引</td></tr> <tr><td>*.timeindex</td> <td>索引文件，存储时间戳索引</td></tr></tbody></table> <p>索引文件是按照位移和时间戳升序排序的，可以使用二分查找来索引文件中找消息的索引，时间复杂度为O(logN)</p> <p>kafka 默认是保留最近7天的数据，每天都会把7天以前的数据给清理掉，包括 .log .index .timeindex 文件</p> <table><thead><tr><th>参数名</th> <th>描述</th> <th>默认值</th></tr></thead> <tbody><tr><td>log.segment.bytes</td> <td>每个日志段文件的大小，即 *.log 文件的大小</td> <td>1GB</td></tr> <tr><td>log.index.interval.bytes</td> <td>在日志文件中写入多少条数据，就要在索引文件（包括偏移量索引文件和时间戳索引文件）写一条索引，默认是4kb，所以索引本身是稀疏索引</td> <td>4kb</td></tr> <tr><td>log.retention.hours</td> <td>消息保留多少个小时</td> <td>7天</td></tr></tbody></table> <h3 id="kafka是如何实现高性能读写的"><a href="#kafka是如何实现高性能读写的" class="header-anchor">#</a> Kafka是如何实现高性能读写的？</h3> <p><strong>Kafka 通过 PageCache 和 顺序写来实现高性能写</strong></p> <p>PageCache
<img src="https://img-blog.csdnimg.cn/dac52b651424414f99ad38bb158039ee.png" alt="在这里插入图片描述">
这个page cache有什么用呢？我们知道对内存和磁盘进行读写的速度差了好几个数量级，为了避免每次读写文件时，都需要对磁盘进行操作，Linux使用page cache来对文件中的数据进行缓存。</p> <p>每次读文件时，如果读取的数据在页缓存中已经存在，直接返回，否则将文件中的数据拷贝到页缓存（同时会对相邻的页进行预读取），然后再将页缓存中的数据拷贝给用户</p> <p>每次写文件时，如果写入的数据所在的页缓存已经存在，则直接把新数据写入到页缓存中即可，否则将文件中的数据拷贝到页缓存，并把新数据写入到页缓存，内核在一定时机把页缓存刷新到文件中</p> <p><strong>由于page cache的存在，当对文件进行顺序读写时性能很高</strong></p> <p><img src="https://img-blog.csdnimg.cn/4e695ce092af40c0919afb0171728f9d.png" alt="在这里插入图片描述"></p> <p><strong>Kafka 通过 PageCache 和 零拷贝实现高性能读</strong> <img src="https://img-blog.csdnimg.cn/12c4f06d487b479a99a2b4a22993287a.png" alt="在这里插入图片描述"></p> <p>当我们通过普通方式进行文件读取时，会有4次上下文切换，4次数据拷贝（至于为什么要进行上下文切换等各种细节，可以参考其他文章）。从图中可以看到CPU复制2和CPU复制3完全没必要啊，能不能省略呢？当然可以了，省略后就是大名鼎鼎的零拷贝了</p> <h2 id="副本机制"><a href="#副本机制" class="header-anchor">#</a> 副本机制</h2> <p>为了防止数据丢失，Kafka 使用了副本机制，对每个 partition 上的数据进行备份，接收读和写的请求的副本叫做 <strong>leader 副本</strong>，单纯同步数据的副本叫做 <strong>follower 副本</strong> <img src="https://img-blog.csdnimg.cn/direct/05b57508b68f40618c3d361cb6277920.png" alt="在这里插入图片描述"></p> <h3 id="isr"><a href="#isr" class="header-anchor">#</a> ISR</h3> <p>当 leader 副本宕机后，会从 follower 副本选一个成本新的 leader 副本，显然不是所有的 follower 副本都有资格去竞选 leader，对于那些落后 leader 进度太多的 follower 而言，它们是没有资格竞选 leader 的，基于这个原因，kafka 引入了 isr 的概念</p> <p>isr 是 kafka 集群动态维护的一组同步副本集合（in-sync replicas）。leader 副本总是包含在 isr 中的，只有 isr 中的副本才有资格被选举为 leader。follower 在 <strong>replica.lag.time.max.ms</strong> 指定的时间段内没有发送任何拉取请求，就会被移除 isr 列表</p> <table><thead><tr><th>名词</th> <th>介绍</th></tr></thead> <tbody><tr><td>AR</td> <td>分区中的所有副本</td></tr> <tr><td>ISR</td> <td>与 leader 保持同步状态的副本合集</td></tr></tbody></table> <table><thead><tr><th>名词</th> <th>介绍</th></tr></thead> <tbody><tr><td>LEO</td> <td>每个分区中最后一条消息的下一个位置</td></tr> <tr><td>HW</td> <td>ISR中最小的LEO即为HW，俗称高水位，消费者只能拉取到HW之前的消息</td></tr></tbody></table> <p><img src="https://img-blog.csdnimg.cn/eabcc97266e54036a25cdb4896ca784b.png" alt="在这里插入图片描述"></p> <h3 id="hw-和-leo-的更新时机"><a href="#hw-和-leo-的更新时机" class="header-anchor">#</a> HW 和 LEO 的更新时机</h3> <p><img src="https://img-blog.csdnimg.cn/direct/1c13a8815ced45d6a84bd7a50d665382.png" alt="在这里插入图片描述"> <strong>leader 和 follower 上的 LEO 是如何更新的？</strong></p> <table><thead><tr><th>更新对象</th> <th>更新时机</th></tr></thead> <tbody><tr><td>leader leo</td> <td>接收到生产者发送的消息，写入本地磁盘后，更新其 leo 值</td></tr> <tr><td>leadr hw</td> <td>主要有两个更新时机，一个是 leader leo 更新后，另一个是 remote leo 更新后。具体算法是：取 leadr 副本和所有与 leader 同步的远程副本 leo 中的最小值</td></tr> <tr><td>remote leo</td> <td>follower 副本从 leader 副本拉取消息时，会告诉 leader 副本从哪个位移处开始拉取，leader 副本会使用这个位移值来更新 remote leo</td></tr> <tr><td>follower leo</td> <td>follower 副本从 leader 副本拉取消息，写入到本地磁盘后，更新其 leo 值</td></tr> <tr><td>folloer hw</td> <td>follower 副本成功更新完 leo 后，会比较其 leo 值和 leader 副本发来的高水位值，用两者的最小值更新其 hw 值</td></tr></tbody></table> <p>与 leader 副本保持同步的判断条件有两个</p> <ol><li>follower 副本在 isr 中</li> <li>follower 副本向 leader 发送复制请求的时间在 replica.lag.time.max.ms 范围内</li></ol> <blockquote><p>乍看上去好像这两个条件说的是一回事，毕竟刚才定义ISR时也是用的这个参数。但某些情况下 Kafka 的确可能出现副本已经“追上”了 leader 的进度，但却不在ISR 中的情况——比如，某个从failure中恢复的副本。如果Kafka只判断第一个条件，确定分区HW值时就不会考虑这些未在 ISR中的副本，但这些副本已经具备了“立刻进入 ISR”的资格，因此就可能出现分区HW值越过ISR中副本LEO的情况——这肯定是不允许的，因为分区HW实际上就是ISR中所有副本LEO的最小值（原文来自 Apache Kafka 实战）</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/direct/1c5b23b990594ea2a978b96ac476cd47.png" alt="在这里插入图片描述"></p> <table><thead><tr><th>参数名</th> <th>描述</th> <th>默认值</th></tr></thead> <tbody><tr><td>min.insync.replicas</td> <td>isr 列表必须有多少个副本与 leader 副本保持同步</td> <td>1</td></tr> <tr><td>replica.lag.time.max.ms</td> <td>follwer 在这个时间段没有发送任何拉取请求，则会被移除 isr 列表</td> <td>10s</td></tr></tbody></table> <p>min.insync.replicas=2，acks=-1，生产者要求必须有2个副本在 isr 里，并且所有副本全部接收到数据才能算写入成功，一旦 isr 副本里面小于2个，还是可能会导致生产数据被卡住</p> <p>follower 跟不上的情况主要有如下两种</p> <ol><li>follower 所在机器的性能变差，比如网络负载过高，IO负载过高，CPU负载过高，机器负载过高，都可能导致机器性能变差</li> <li>follower 所在的 borker 进程卡顿，常见的就是 fullgc 问题（比较少）</li></ol> <p>高水位机制在 leader 切换时可能会发生日志丢失和日志错乱的问题，所以引入了 leader epoch，有兴趣的同学可以参考一下其他的文章</p> <h2 id="kafka-控制器"><a href="#kafka-控制器" class="header-anchor">#</a> Kafka 控制器</h2> <p><strong>控制器组件（Controller）是 Apache Kafka 的核心组件。它的主要作用是在 Zookeeper 的帮助下管理和协调整个 Kafka 集群</strong></p> <p><strong>控制器是如何选举出来的？</strong></p> <p>在 Kafka 集群启动的时候，会自动选举一台 broker 出来承担控制器的责任。在启动的过程中每台 broker 都会尝试在zk上创建一个 /controller 临时节点，zk 会保证只有一个 broker 可以创建成功，创建成功的 broker 就是 controller。</p> <p>一旦控制器对应的 broker 宕机了，此时临时节点消失，集群中的其他节点会一直监听这个临时节点，发现临时节点消失，就争抢再次创建临时节点，保证有一台新的 broker 成为控制器</p> <p><strong>控制器保存了哪些数据？</strong></p> <p>控制器几乎包含了所有 Kafka 集群的数据，比较重要的数据有</p> <ol><li>所有 topic 信息，包括具体的分区信息，比如 leader 副本是谁，ISR 集合中有哪些副本等</li> <li>所有 broker 信息，包括正在运行的 broker，正在关闭的 broker</li></ol> <p><strong>控制器有哪些作用？</strong></p> <ol><li>集群管理，管理集群中的各个broker，包括broker的上下线，broker的状态变化，partition的副本分配和迁移，</li> <li>leader选举，控制器参与 leader 选举，当某个 partition 的 leader 出现故障时，controller 会协调其他副本参与 leader 选举，选举一个新的 leader 来继续服务，保证了集群的高可用</li> <li>topic管理，管理 topic 的创建，修改和删除操作，同时也负责对 topic 的分区数和副本数等参数进行调节</li> <li>数据服务，向其他 broker 提供数据服务，控制器上保存了最全的集群元数据信息，其他 broker 会定期获取元数据</li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/erlieStar/javashitang/edit/master/docs/md/kafka/Kafka消息存储.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/md/kafka/Kafka集群搭建.html" class="prev">
        Kafka 集群搭建
      </a></span> <span class="next"><a href="/blog/md/kafka/Kafka消息发送.html">
        Kafka 消息发送
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.c036f1e4.js" defer></script><script src="/blog/assets/js/2.9b5c8eec.js" defer></script><script src="/blog/assets/js/179.1f8c84d1.js" defer></script>
  </body>
</html>
